"use strict";angular.module("generator",["perfect","csvMagic"]),angular.module("generator").run(),function(){angular.module("csvMagic",[]);var e='<div class="csv-magic flex-row"><div><input type="file" id="fileinput"><a href="" ng-click="update()" class="button">Update graph</a></div><div><a id="downloadblank" class="button">Download blank</a></div></div>';angular.module("csvMagic").directive("csvMagic",[function(){return{replace:!0,scope:{question:"=",answers:"="},template:e,controller:["$scope",function(e){var a=this;this.init=function(e){a.input=e[0].querySelector("#fileinput"),a.input.onchange=function(){a.update()};var n=e[0].querySelector("#downloadblank");r(n)};var r=function(e){var a=[["Question",""],["Answer","Control rate","Exposed rate","Significance color","Min lift","Absolute lift","Max lift"]],r="data:text/csv;charset=utf-8,";a.forEach(function(e,n){r+=n<a.length?e.join(",")+"\n":e.join(",")});var n=encodeURI(r);e.setAttribute("href",n),e.setAttribute("download","blank_charts.csv")};this.update=function(){if(!a.input.files.length)return!1;var r=a.input.files[0],t=new FileReader;t.onload=function(a){var r=t.result.split(/\r?\n/);console.log("Init",r),r=r.filter(function(e){return e.length}).map(function(e){return e.split(",")}),console.log("Split",r);var s=n(r);e.question=s[0],e.answers=s[1]},t.readAsText(r)};var n=function(e){var a=e.shift();return e.shift(),[a[1],e.map(function(e){return{copy:e[0],control:e[1],exposed:e[2],color:e[3],range:[e[4],e[5],e[6]]}})]}}],link:function(e,a,r,n){n.init(a),e.update=n.update}}}])}(),function(){angular.module("errorRange",[]);var e='<figure class="essrange flex-row"><div class="essrange__min" display="{{low}}%" style="flex: 0 1 {{minWidth}}%"></div><div class="essrange__bar"></div><div class="essrange__max" display="{{high}}%" style="flex: 0 1 {{maxWidth}}%"></div><div ng-class="{\'show-label\': showCircleLabel}" class="essrange__val" display="{{val}}%" style="left: calc({{valPos}}% - .5rem)"></div></figure>';angular.module("errorRange").directive("essRange",[function(){return{scope:{min:"=",max:"=",high:"=",low:"=",val:"=",showCircleLabel:"="},template:e,link:function(e,a,r){e.$watch("min+max+high+low+val",function(){var a=e.max-e.min;e.minWidth=(e.low-e.min)/a*100,e.maxWidth=(e.max-e.high)/a*100,e.valPos=(e.val-e.min)/a*100})}}}])}(),function(){function e(e){console.log(e);var a=document.createElement("a");document.body.appendChild(a),domtoimage.toBlob(document.querySelector("#render-me")).then(function(r){var n=window.URL.createObjectURL(r);a.href=n,a.download=e+".png",a.click(),window.URL.revokeObjectURL(n)})}angular.module("perfect",["errorRange"]);var a='<figure class="perfect flex-col"><div class="perfect__header flex-row"><div class="perfect__header--question"><span ng-show="data.question">Q:</span> {{data.question}}</div><div class="perfect__header--relative" ng-if="showRelativeLift">Relative lift</div><div class="perfect__header--observed" ng-class="{wider: !showRelativeLift}">Absolute lift</div><div class="perfect__header--range" ng-class="{wider: !showRelativeLift}">Lift range</div></div><div class="perfect__answer flex-row align-middle" ng-repeat="answer in data.answers"><div class="perfect__answer--copy">{{answer.copy}}</div><div class="perfect__answer--split"><div><cprogress class="control" max="maxPercent" value="answer.control"></cprogress><label style="left: {{(answer.control / maxPercent) * 100}}%">{{answer.control | number:barDec}}%</label></div><div><cprogress class="exposed" max="maxPercent" value="answer.exposed"></cprogress><label style="left: {{(answer.exposed / maxPercent) * 100}}%">{{answer.exposed | number:barDec}}%</label></div></div><div class="perfect__answer--relative {{answer.color}}" ng-if="showRelativeLift">{{((answer.exposed / answer.control) - 1) * 100.0 | number:relativeDec | pn}}%</div><div class="perfect__answer--observed {{answer.color}}" ng-class="{wider: !showRelativeLift}">{{answer.exposed - answer.control | number:observedDec | pn}}%</div><div class="perfect__answer--range" ng-class="{wider: !showRelativeLift}"><ess-range min="minRange" max="maxRange" high="answer.range[2]" low="answer.range[0]" val="answer.range[1]" class="{{answer.color}}" show-circle-label="showCircleLabel"></ess-range></div></div></figure>';angular.module("perfect").directive("perfect",[function(){return{scope:{data:"=",barDec:"=",observedDec:"=",relativeDec:"=",showCircleLabel:"=",showRelativeLift:"="},template:a,link:function(e,a,r){e.$watch("data",function(){var a=e.data.answers.reduce(function(e,a){return parseFloat(a.range[2])>e?parseFloat(a.range[2]):e},-100);e.maxRange=a+.1*a,e.minRange=e.data.answers.reduce(function(e,a){return parseFloat(a.range[0])<e?parseFloat(a.range[0]):e},100),e.maxPercent=e.data.answers.reduce(function(e,a){return a.control>e&&(e=parseFloat(a.control)),a.exposed>e&&(e=parseFloat(a.exposed)),e},-100),e.maxPercent>10?e.maxPercent+=10:e.maxPercent>1?e.maxPercent+=1:e.maxPercent>.1?(e.maxPercent+=.1,e.barDec=1):e.maxPercent>.01?(e.maxPercent+=.01,e.barDec=2):e.maxPercent>.001?(e.maxPercent+=.001,e.barDec=3):e.maxPercent>1e-4?(e.maxPercent+=1e-4,e.barDec=4):e.maxPercent>1e-5?(e.maxPercent+=1e-5,e.barDec=5):e.maxPercent>1e-6?(e.maxPercent+=1e-6,e.barDec=6):e.maxPercent>1e-7&&(e.maxPercent+=1e-7,e.barDec=7)},!0)}}}]),angular.module("perfect").filter("pn",function(){return function(e){return e>0?"+"+e:e}}),angular.module("perfect").controller("perfect",["$scope",function(a){a.render=e,a.width=100,a.theme="",a.barDec=1,a.observedDec=1,a.relativeDec=1,a.showCircleLabel=!0,a.showRelative=!0,a.maxPercentage=100,a.data={question:"",answers:[]}}])}(),function(){var e='<span class="progress-container"><span class="progress-value"></span></span>';angular.module("perfect").directive("cprogress",[function(){return{scope:{max:"=",value:"="},template:e,link:function(e,a,r){var n=a[0].querySelector(".progress-value");e.$watch("max+value",function(){n.style.width=e.value/e.max*100+"%"})}}}])}();